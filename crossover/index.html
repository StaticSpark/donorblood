<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no">
<title>Get started with MapView - Create a 2D map</title>
<style>
  html, body, #viewDiv {
    padding: 0;
    margin: 0;
    height: 100%;
    width: 100%;
  }
</style>
<link rel="stylesheet" href="https://js.arcgis.com/4.3/esri/css/main.css">
<script src="https://js.arcgis.com/4.3/"></script>
<script>
require([
  "esri/Map",
  "esri/tasks/Locator",
  "esri/views/MapView",
  "esri/Graphic",
  "esri/geometry/Point",
  "esri/symbols/SimpleMarkerSymbol",
  "esri/widgets/Search",
  "esri/widgets/Locate",
  "dojo/domReady!"
], function(Map,Locator,MapView,Graphic,Point,SimpleMarkerSymbol,Search,Locate){
  var map = new Map({
    basemap: "streets"
  });
  var view = new MapView({
    container: "viewDiv",  // Reference to the scene div created in step 5
    map: map,  // Reference to the map object created before the scene
    zoom: 4,  // Sets the zoom level based on level of detail (LOD)
    center: [15, 65]  // Sets the center point of view in lon/lat
  });

  var searchWidget = new Search({
        view: view,
        popupOpenOnSelect:false,
	popupEnabled:false,
	resultGraphicEnabled:false
      });

      // Add the search widget to the very top left corner of the view
      view.ui.add(searchWidget, {
        position: "top-left",
        index: 0
      });

  var locateBtn = new Locate({
        view: view
      });

      // Add the locate widget to the top left corner of the view
      view.ui.add(locateBtn, {
        position: "top-left"
      });

  // Create a locator task using the world geocoding service
  var locatorTask = new Locator({
       url: "https://geocode.arcgis.com/arcgis/rest/services/World/GeocodeServer"
  });

  view.on("click", function(event) {
    // Get the coordinates of the click on the view
    // around the decimals to 3 decimals
    var lat = Math.round(event.mapPoint.latitude * 1000) / 1000;
    var lon = Math.round(event.mapPoint.longitude * 1000) / 1000;

    view.popup.open({
        // Set the popup's title to the coordinates of the clicked location
        title: "Reverse geocode: [" + lon + ", " + lat + "]",
        location: event.mapPoint // Set the location of the popup to the clicked location
    });

    // Execute a reverse geocode using the clicked location
    //locatorTask.locationToAddress(event.mapPoint).then(function(response) {

     // If an address is successfully found, print it to the popup's content;
     //view.popup.content = response.address.Match_addr;
    //}).otherwise(function(err) {
     // If the promise fails and no result is found, print a generic message to the popup's content
     //view.popup.content = "No address was found for this location";
    //});
	
    view.popup.content = "<form><input type='text'></input><br	><input type='submit'></input></form>";
  });

  // First create a point geometry (this is the location of the Titanic)
      var point = new Point({
        longitude: -49.97,
        latitude: 41.73
      });

      // Create a symbol for drawing the point
      var markerSymbol = new SimpleMarkerSymbol({
        color: [226, 119, 40],
        outline: { // autocasts as new SimpleLineSymbol()
          color: [255, 255, 255],
          width: 2
        }
      });

      // Create an object for storing attributes related to the line
      var pointAtt = {
        Name: "Keystone Pipeline",
        Owner: "TransCanada",
        Length: "3,456 km"
      };


      // Create a graphic and add the geometry and symbol to it
      var pointGraphic = new Graphic({
        geometry: point,
        symbol: markerSymbol,
	attributes: pointAtt,
        popupTemplate: { // autocasts as new PopupTemplate()
          title: "{Name}",
          content: [{
            type: "fields",
            fieldInfos: [{
              fieldName: "Name"
            }, {
              fieldName: "Owner"
            }, {
              fieldName: "Length"
            }]
          }]
        }
      });

     // Add the graphics to the view's graphics layer
      view.graphics.addMany([pointGraphic]);
 
     view.watch("extent", function(){
        if (!view.animation || view.animation.isFulfilled()){
		var obj = {latitude:view.center.latitude,
			   longitude:view.center.longitude,
			   width:view.extent.width,
			  height:view.extent.height};
		console.dir(obj);//center,width,height
	}
	
     });
});
</script>
</head>
<body>
  <div id="viewDiv"></div>
</body>
</html>
